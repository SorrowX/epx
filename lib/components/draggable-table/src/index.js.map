{"version":3,"file":"index.js","sources":["../../../../../../packages/components/draggable-table/src/index.ts"],"sourcesContent":["import { defineComponent, h, nextTick } from 'vue'\nimport { ElTable, useNamespace } from 'element-plus'\nimport { UseSortable } from '@vueuse/integrations/useSortable/component'\nimport { moveArrayElement } from '@vueuse/integrations/useSortable'\nimport { isArray } from '@element-plus/utils'\nimport { draggableTableProps } from './draggable-table'\nimport type { VNode } from 'vue'\n\nconst ElTableComp: any = { ...ElTable }\n\nconst SORT_DATA_EVENT = 'sort-data'\n\n// 重写 TableBody render 函数\nconst TableBody = {\n  ...ElTableComp.components.TableBody,\n  render() {\n    const { wrappedRowRender, store } = this\n    const data = store.states.data.value || []\n\n    const tableIns = this.context\n    const { draggableProps } = tableIns.props\n\n    const options = {\n      animation: 300,\n      ...draggableProps,\n      onUpdate: (e: any) => {\n        const { oldIndex, newIndex } = e\n        // update list\n        if (isArray(store.states.data.value)) {\n          moveArrayElement(store.states.data, oldIndex, newIndex, e)\n          nextTick(() => {\n            const newData = store.states.data.value\n            store.commit('setData', newData)\n            tableIns.emit(SORT_DATA_EVENT, newData, { e })\n          })\n        }\n      },\n    }\n\n    return h(\n      UseSortable,\n      { options, tag: 'tbody', tabIndex: -1, modelValue: [] },\n      {\n        default: () =>\n          data.reduce((acc: VNode[], row: any) => {\n            return acc.concat(wrappedRowRender(row, acc.length))\n          }, []),\n      }\n    )\n  },\n}\n\nconst ElTableClone = {\n  ...ElTableComp,\n  name: 'ElTableClone',\n  components: { ...ElTableComp.components, TableBody },\n  emits: [...ElTableComp.emits, SORT_DATA_EVENT],\n  props: {\n    ...ElTableComp.props,\n    ...draggableTableProps,\n  },\n}\n\nconst ElDraggableTable = defineComponent({\n  name: 'ElDraggableTable',\n  setup(props, { slots, attrs }) {\n    const ns = useNamespace('draggable-table')\n\n    return () =>\n      h(\n        ElTableClone,\n        {\n          ...attrs,\n          class: ns.b(),\n        },\n        slots\n      )\n  },\n})\n\nexport default ElDraggableTable\n"],"names":["ElTable","isArray","moveArrayElement","nextTick","h","UseSortable","draggableTableProps","defineComponent","useNamespace"],"mappings":";;;;;;;;;;;AAQA,MAAM,WAAA,GAAmB,EAAE,GAAGA,mBAAQ,EAAA,CAAA;AAEtC,MAAM,eAAkB,GAAA,WAAA,CAAA;AAGxB,MAAM,SAAY,GAAA;AAAA,EAChB,GAAG,YAAY,UAAW,CAAA,SAAA;AAAA,EAC1B,MAAS,GAAA;AACP,IAAM,MAAA,EAAE,gBAAkB,EAAA,KAAA,EAAU,GAAA,IAAA,CAAA;AACpC,IAAA,MAAM,IAAO,GAAA,KAAA,CAAM,MAAO,CAAA,IAAA,CAAK,SAAS,EAAC,CAAA;AAEzC,IAAA,MAAM,WAAW,IAAK,CAAA,OAAA,CAAA;AACtB,IAAM,MAAA,EAAE,cAAe,EAAA,GAAI,QAAS,CAAA,KAAA,CAAA;AAEpC,IAAA,MAAM,OAAU,GAAA;AAAA,MACd,SAAW,EAAA,GAAA;AAAA,MACX,GAAG,cAAA;AAAA,MACH,QAAA,EAAU,CAAC,CAAW,KAAA;AACpB,QAAM,MAAA,EAAE,QAAU,EAAA,QAAA,EAAa,GAAA,CAAA,CAAA;AAE/B,QAAA,IAAIC,aAAQ,CAAA,KAAA,CAAM,MAAO,CAAA,IAAA,CAAK,KAAK,CAAG,EAAA;AACpC,UAAAC,4BAAA,CAAiB,KAAM,CAAA,MAAA,CAAO,IAAM,EAAA,QAAA,EAAU,UAAU,CAAC,CAAA,CAAA;AACzD,UAAAC,YAAA,CAAS,MAAM;AACb,YAAM,MAAA,OAAA,GAAU,KAAM,CAAA,MAAA,CAAO,IAAK,CAAA,KAAA,CAAA;AAClC,YAAM,KAAA,CAAA,MAAA,CAAO,WAAW,OAAO,CAAA,CAAA;AAC/B,YAAA,QAAA,CAAS,IAAK,CAAA,eAAA,EAAiB,OAAS,EAAA,EAAE,GAAG,CAAA,CAAA;AAAA,WAC9C,CAAA,CAAA;AAAA,SACH;AAAA,OACF;AAAA,KACF,CAAA;AAEA,IAAO,OAAAC,KAAA;AAAA,MACLC,qBAAA;AAAA,MACA,EAAE,SAAS,GAAK,EAAA,OAAA,EAAS,UAAU,CAAI,CAAA,EAAA,UAAA,EAAY,EAAG,EAAA;AAAA,MACtD;AAAA,QACE,SAAS,MACP,IAAA,CAAK,MAAO,CAAA,CAAC,KAAc,GAAa,KAAA;AACtC,UAAA,OAAO,IAAI,MAAO,CAAA,gBAAA,CAAiB,GAAK,EAAA,GAAA,CAAI,MAAM,CAAC,CAAA,CAAA;AAAA,SACrD,EAAG,EAAE,CAAA;AAAA,OACT;AAAA,KACF,CAAA;AAAA,GACF;AACF,CAAA,CAAA;AAEA,MAAM,YAAe,GAAA;AAAA,EACnB,GAAG,WAAA;AAAA,EACH,IAAM,EAAA,cAAA;AAAA,EACN,UAAY,EAAA,EAAE,GAAG,WAAA,CAAY,YAAY,SAAU,EAAA;AAAA,EACnD,KAAO,EAAA,CAAC,GAAG,WAAA,CAAY,OAAO,eAAe,CAAA;AAAA,EAC7C,KAAO,EAAA;AAAA,IACL,GAAG,WAAY,CAAA,KAAA;AAAA,IACf,GAAGC,kCAAA;AAAA,GACL;AACF,CAAA,CAAA;AAEA,MAAM,mBAAmBC,mBAAgB,CAAA;AAAA,EACvC,IAAM,EAAA,kBAAA;AAAA,EACN,KAAM,CAAA,KAAA,EAAO,EAAE,KAAA,EAAO,OAAS,EAAA;AAC7B,IAAM,MAAA,EAAA,GAAKC,yBAAa,iBAAiB,CAAA,CAAA;AAEzC,IAAA,OAAO,MACLJ,KAAA;AAAA,MACE,YAAA;AAAA,MACA;AAAA,QACE,GAAG,KAAA;AAAA,QACH,KAAA,EAAO,GAAG,CAAE,EAAA;AAAA,OACd;AAAA,MACA,KAAA;AAAA,KACF,CAAA;AAAA,GACJ;AACF,CAAC;;;;"}
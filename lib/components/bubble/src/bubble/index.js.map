{"version":3,"file":"index.js","sources":["../../../../../../../packages/components/bubble/src/bubble/index.ts"],"sourcesContent":["import {\n  computed,\n  defineComponent,\n  h,\n  isVNode,\n  ref,\n  toValue,\n  unref,\n  watch,\n  watchEffect,\n} from 'vue'\nimport { ElAvatar, useNamespace } from 'element-plus'\nimport { DIV_TAG } from '@element-plus/constants'\nimport { UserFilled } from '@element-plus/icons-vue'\nimport { isBoolean } from '@element-plus/utils'\nimport { useBubbleContextInject } from '../context'\nimport useTypedEffect from '../hooks/use-typed-effect'\nimport useTypingConfig from '../hooks/use-typing-config'\nimport Loading from '../loading'\nimport { bubbleProps } from './bubble'\n\nexport default defineComponent({\n  name: 'ElBubble',\n  props: bubbleProps,\n  setup(props, { attrs, slots, expose }) {\n    const ns = useNamespace('bubble')\n    const prefixCls = ns.b()\n\n    const content = computed(() => props.content ?? '')\n\n    const { onUpdate } = unref(useBubbleContextInject())\n\n    const divRef = ref<HTMLDivElement>()\n\n    const [typingEnabled, typingStep, typingInterval, typingSuffix] =\n      useTypingConfig(props)\n\n    const [typedContent, isTyping] = useTypedEffect(\n      content,\n      typingEnabled,\n      typingStep,\n      typingInterval\n    )\n\n    const hasTypingClass = computed(\n      () =>\n        isTyping.value &&\n        !props.loading &&\n        !props.messageRender &&\n        !typingSuffix.value\n    )\n\n    const triggerTypingCompleteRef = ref(false)\n    watchEffect(() => {\n      if (!isTyping.value && !props.loading) {\n        if (!triggerTypingCompleteRef.value) {\n          triggerTypingCompleteRef.value = true\n          props.onTypingComplete?.()\n        }\n      } else {\n        triggerTypingCompleteRef.value = false\n      }\n    })\n\n    watch(typedContent, () => {\n      onUpdate?.()\n    })\n\n    expose({\n      nativeElement: divRef,\n    })\n\n    return () => {\n      const {\n        avatar,\n        messageRender,\n        loading,\n        loadingRender,\n        variant,\n        shape,\n        header,\n        footer,\n        placement,\n      } = props\n\n      const renderAvatar = () => {\n        return avatar || slots.avatar\n          ? h(\n              DIV_TAG,\n              {\n                class: ns.b('avatar'),\n              },\n              [\n                slots.avatar\n                  ? slots.avatar()\n                  : isVNode(avatar)\n                  ? avatar\n                  : h(ElAvatar, {\n                      icon: UserFilled,\n                      ...(isBoolean(avatar) ? {} : avatar),\n                    }),\n              ]\n            )\n          : ''\n      }\n\n      const renderHeader = () => {\n        return (\n          (header || slots.header) &&\n          h(\n            DIV_TAG,\n            {\n              style: props.headerStyle,\n              class: [`${prefixCls}-header`, props.headerClass],\n            },\n            slots.header?.() ?? header\n          )\n        )\n      }\n\n      const renderContent = () => {\n        const mergedContent = () =>\n          messageRender\n            ? messageRender(typedContent.value as any)\n            : typedContent.value\n\n        const contentNode = () => {\n          if (loading || slots.loading) {\n            return [\n              slots.loading\n                ? slots.loading()\n                : loadingRender\n                ? loadingRender()\n                : h(Loading),\n            ]\n          } else {\n            // 默认插槽和content插槽都可以作为内容\n            const contentSlot = slots.default ?? slots.content\n            return [\n              contentSlot ? contentSlot() : mergedContent(),\n              isTyping.value ? toValue(typingSuffix) : '',\n            ]\n          }\n        }\n\n        return h(\n          DIV_TAG,\n          {\n            style: props.contentStyle,\n            class: [\n              `${prefixCls}-content`,\n              `${prefixCls}-content-${variant}`,\n              { [`${prefixCls}-content-${shape}`]: shape },\n              props.contentClass,\n            ],\n          },\n          contentNode() as any\n        )\n      }\n\n      const renderFooter = () => {\n        return (\n          (footer || slots.footer) &&\n          h(\n            DIV_TAG,\n            {\n              style: props.footerStyle,\n              class: [`${prefixCls}-footer`, props.footerClass],\n            },\n            slots.footer?.() ?? footer\n          )\n        )\n      }\n\n      const renderFullContent = () => {\n        const contentVNode = renderContent()\n        if (header || slots.header || footer || slots.footer) {\n          return h(\n            DIV_TAG,\n            {\n              class: ns.b('content-wrapper'),\n            },\n            [renderHeader(), contentVNode, renderFooter()]\n          )\n        }\n        return contentVNode\n      }\n\n      return h(\n        DIV_TAG,\n        {\n          ...attrs,\n          ref: divRef,\n          class: [\n            prefixCls,\n            ns.b(placement),\n            hasTypingClass.value ? [ns.b('typing')] : '',\n          ].concat((attrs as any).class),\n        },\n        [renderAvatar(), renderFullContent()]\n      )\n    }\n  },\n})\n"],"names":["defineComponent","bubbleProps","useNamespace","computed","unref","useBubbleContextInject","ref","useTypingConfig","useTypedEffect","watchEffect","watch","loading","h","DIV_TAG","isVNode","ElAvatar","UserFilled","isBoolean","Loading","toValue"],"mappings":"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"}